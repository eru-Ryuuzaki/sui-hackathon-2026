# Journal Editor Enhancement Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Enhance the JournalEditor component with a robust template system, improved interaction logic (category-type linkage, auto-fill, overrides), and better data validation, matching the "Earth Online" system log design.

**Architecture:**

* **Data Source:** Extract template data to `src/data/logTemplates.ts` (mapped from provided JS structure).

* **Component Logic:** Refactor `JournalEditor.tsx` to handle:

  * `category` -> `type` cascading selection.

  * `template` selection -> auto-fill `message` & `icon`.

  * Custom override detection (`isCustomMessage`, `isCustomIcon`).

  * Date validation (birth date check, future date check).

* **UI:** Add Template Selector, Type Selector (dynamic), and improved Icon Selector (popover/expandable).

**Tech Stack:** React, Lucide React (Icons), date-fns, Tailwind CSS.

***

### Task 1: Create Template Data Source

**Files:**

* Create: `src/data/logTemplates.ts`

**Step 1: Define Interfaces and Data**

* Create interfaces for `LogTemplate` and the template map structure.

* Port the provided `logTemplates.js` content to TypeScript.

* Ensure all categories (system, life\_event, etc.) and types are covered.

**Step 2: Verify Import**

* Ensure it can be imported in `JournalEditor.tsx`.

### Task 2: Refactor JournalEditor State & Logic

**Files:**

* Modify: `src/components/ui/JournalEditor.tsx`

**Step 1: Update State Definitions**

* Add `selectedTemplate` (string | null).

* Add `isCustomMessage` (boolean), `isCustomIcon` (boolean).

* Add `icon` state (string) - defaulting to category default or template icon.

* Add `availableTypes` derived state (based on category).

**Step 2: Implement Category Change Logic**

* When `category` changes:

  * Reset `type` to first available.

  * Reset `selectedTemplate` to null.

  * Reset `isCustomMessage`, `isCustomIcon` to false.

  * Auto-fill default system check if category is 'SYSTEM'.

**Step 3: Implement Type Change Logic**

* When `type` changes:

  * Filter templates.

  * Handle special case: if switching *from* system.INFO default, clear message.

**Step 4: Implement Template Selection Logic**

* When `template` selected:

  * Set `body` (message).

  * Set `icon`.

  * Set `isCustomMessage = false`.

**Step 5: Implement Custom Override Logic**

* `handleBodyChange`: Set `isCustomMessage = true`.

* `handleIconChange`: Set `isCustomIcon = true`.

### Task 3: Enhance UI Components (Selectors)

**Files:**

* Modify: `src/components/ui/JournalEditor.tsx`

**Step 1: Update Category & Type Selectors**

* Bind to new logic.

* Ensure Type selector options are dynamic based on Category.

**Step 2: Add Template Selector**

* Dropdown showing templates for current Category/Type.

* Include "✍️ Custom Message" option.

**Step 3: Add Icon Selector**

* Simple popover or expander to pick common emojis.

* Update `icon` state on selection.

### Task 4: Data Validation & Submission

**Files:**

* Modify: `src/components/ui/JournalEditor.tsx`

**Step 1: Date Validation**

* In `useEffect` for date/time:

  * Check if date < birthday -> Error "Time Paradox: Pre-Origin".

  * Check if date > now -> Error "Time Paradox: Future Event".

  * Disable submit button if invalid.

**Step 2: Final Payload Assembly**

* Ensure `sysTrace` uses the correct format: `[DATE][FRAME][CAT]TYPE: ICON MESSAGE`.

* Ensure `metadata` includes the selected `icon`.

### Task 5: Visual Polish (Optional)

**Files:**

* Modify: `src/components/ui/JournalEditor.tsx`

**Step 1: Frame Animation**

* Add simple CSS transition or `CountUp` effect for `lifeFrame` if feasible (or just keep it simple for now).

